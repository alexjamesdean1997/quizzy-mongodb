{% extends 'common.html.twig' %}
{% block body %}
    <main class="container">
        <h1 class="title">Vos stats</h1>

        {% if scores == false %}
            <h2 class="subtitle">revenez lorsque vous aurez commencé à jouer</h2>
        {% endif %}

        {% if rankings %}
            <h2 class="subtitle">Classement par catégorie</h2>
            <div class="leaderboard collapsable collapsable--stats">
                {% for key, ranking in rankings %}
                    {% set category = key %}
                    {% if key == "all" %}
                        {% set category = "général" %}
                    {% elseif key == "celebrites" %}
                        {% set category = "célébrités" %}
                    {% elseif key == "geographie" %}
                        {% set category = "géographie" %}
                    {% elseif key == "litterature" %}
                        {% set category = "littérature" %}
                    {% elseif key == "television" %}
                        {% set category = "télévision" %}
                    {% endif %}
                    {% set icon = 'build/' ~ key ~ '-color.svg' %}
                    <div class="leader">
                        <div class="category-icon">
                            <img src="{{ asset(icon) }}" alt="{{ key }} icon">
                        </div>

                        <div class="name name--category">{{ category }}</div>
                        <div class="rank rank--category"><span>#</span>{{ ranking }}</div>
                    </div>
                {% endfor %}
                <div class="collapser">
                    <img src="{{ asset('build/collapse.svg') }}" alt="collapse icon">
                    <span class="more-span">Show more</span>
                    <span class="less-span">Show less</span>
                </div>
            </div>
        {% endif %}

        {% if scores %}
            <h2 class="subtitle">Score par catégorie</h2>
            <div class="leaderboard collapsable collapsable--stats">
                {% for key, score in scores %}
                    {% set category = key %}
                    {% if key == "all" %}
                        {% set category = "général" %}
                    {% elseif key == "celebrites" %}
                        {% set category = "célébrités" %}
                    {% elseif key == "geographie" %}
                        {% set category = "géographie" %}
                    {% elseif key == "litterature" %}
                        {% set category = "littérature" %}
                    {% elseif key == "television" %}
                        {% set category = "télévision" %}
                    {% endif %}
                    {% set icon = 'build/' ~ key ~ '-color.svg' %}
                    <div class="leader">
                        <div class="category-icon">
                            <img src="{{ asset(icon) }}" alt="{{ key }} icon">
                        </div>

                        <div class="name name--category">{{ category }}</div>
                        <div class="rank rank--category">{{ score }}<span>pts</span></div>
                    </div>
                {% endfor %}
                <div class="collapser">
                    <img src="{{ asset('build/collapse.svg') }}" alt="collapse icon">
                    <span class="more-span">Show more</span>
                    <span class="less-span">Show less</span>
                </div>
            </div>
        {% endif %}

        {% if sucess_rate %}
            <h2 class="subtitle">Taux de réussite par catégorie</h2>
            <div class="leaderboard collapsable collapsable--stats">
                {% for key, score in sucess_rate %}
                    {% set category = key %}
                    {% if key == "all" %}
                        {% set category = "général" %}
                    {% elseif key == "celebrites" %}
                        {% set category = "célébrités" %}
                    {% elseif key == "geographie" %}
                        {% set category = "géographie" %}
                    {% elseif key == "litterature" %}
                        {% set category = "littérature" %}
                    {% elseif key == "television" %}
                        {% set category = "télévision" %}
                    {% endif %}
                    {% set icon = 'build/' ~ key ~ '-color.svg' %}
                    <div class="leader">
                        <div class="category-icon">
                            <img src="{{ asset(icon) }}" alt="{{ key }} icon">
                        </div>

                        <div class="name name--category">{{ category }}</div>
                        <div class="rank rank--category">{{ score }}<span>%</span></div>
                    </div>
                {% endfor %}
                <div class="collapser">
                    <img src="{{ asset('build/collapse.svg') }}" alt="collapse icon">
                    <span class="more-span">Show more</span>
                    <span class="less-span">Show less</span>
                </div>
            </div>
        {% endif %}

        {% if categories_played %}
            <h2 class="subtitle">Catégories préféré</h2>
            <div id="favoriteCategories" class="leaderboard">

            </div>
        {% endif %}

    </main>
{% endblock %}
{% block javascripts %}
    <script src="https://cdn.amcharts.com/lib/4/core.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/themes/dataviz.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>

    <script>
        // Themes begin
        am4core.useTheme(am4themes_dataviz);
        am4core.useTheme(am4themes_animated);
        // Themes end

        // Create chart instance
        var chart = am4core.create("favoriteCategories", am4charts.PieChart);

        // Add data
        chart.data = [
            {% for category, plays in categories_played %}
                {
                    "category": "{{ category }}",
                    "plays": {{ plays }}
                },
            {% endfor %}
        ];

        // Add and configure Series
        var pieSeries = chart.series.push(new am4charts.PieSeries());
        pieSeries.dataFields.value = "plays";
        pieSeries.dataFields.category = "category";
        pieSeries.slices.template.stroke = am4core.color("#fff");
        pieSeries.slices.template.strokeOpacity = 1;
        pieSeries.alignLabels = false;

        pieSeries.ticks.template.events.on("ready", hideSmall);
        pieSeries.ticks.template.events.on("visibilitychanged", hideSmall);
        pieSeries.labels.template.events.on("ready", hideSmall);
        pieSeries.labels.template.events.on("visibilitychanged", hideSmall);

        // This creates initial animation
        pieSeries.hiddenState.properties.opacity = 1;
        pieSeries.hiddenState.properties.endAngle = -90;
        pieSeries.hiddenState.properties.startAngle = -90;

        function hideSmall(ev) {
            if (ev.target.dataItem.values.value.percent < 5) {
                ev.target.hide();
            }
            else {
                ev.target.show();
            }
        }

        pieSeries.labels.template.disabled = true;
        pieSeries.ticks.template.disabled = true;

        chart.legend = new am4charts.Legend();
        chart.legend.position = "bottom";

        chart.hiddenState.properties.radius = am4core.percent(0);
    </script>
{% endblock %}